<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>车辆信息删除</title>
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1">
<link rel="stylesheet" href="../css/layui.css" media="all">
<link rel="shortcut icon" href="#" />
<script src="../js/common/jquery-2.0.3.min.js"></script>
</head>
<body>
	<table id="demo" lay-filter="demo"></table>
	<script src="../js/common/layui.js" charset="utf-8"></script>
		<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
</script>
	<script>
		layui.use([ 'table', 'laypage' ], function() {
			var table = layui.table;
			table.render({
				elem : '#demo',
				url : '/car-dch/admin/listCar.do',
				width : 1780,
				height : 890,
				response : {
					statusCode : 1000
				//成功的状态码，默认：0
				},
   				page : {
					layout : [ 'prev', 'page', 'next', 'skip', 'limit' ],
					limit : 1000,
					limits : [ 5, 10, 20 ]

				},  

				cols : [ [ //表头
				{
					field : 'cID',
					title : 'ID',
					width : '10%',
					sort : true,
					fixed : 'left'
				}, {
					field : 'cName',
					title : '车名',
					sort : true,
					width : '10%'
				}, {
					field : 'price',
					title : '价格',
					sort : true,
					width : '10%'
				}, {
					field : 'company',
					title : '发行公司',
					sort : true,
					width : '10%'
				}, {
					field : 'type',
					title : '类别',
					sort : true,
					width : '10%'
				}, {
					field : 'detailPath',
					title : '车辆详情',
					width : '10%'
				}, {
					fixed : 'right',
					width : '10%',
					align : 'center',
					toolbar : '#barDemo'
				}] ]

			});
			 table.on('tool(demo)', function(obj){ //注：tool是工具条事件名，test是table原始容器的属性 lay-filter="对应的值"
			      var data = obj.data; //获得当前行数据
			      var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
			      var tr = obj.tr; //获得当前行 tr 的DOM对象

			      if(layEvent === 'delete'){ //删除
			    	  layer.confirm('真的删除ID为：'+data.cID+"的车辆吗?", function(index){
			                //console.log(data.p_id);
			                //向服务端发送删除指令
			                    $.ajax({
			                        url:'/car-dch/admin/deleteCar.do',
			                        type:'POST',
			                        data:{'id':data.cID},//向服务端发送删除的id
			                        success : function(result){
			                            if(result.code == 1000){
			                                obj.del(); //删除对应行（tr）的DOM结构，并更新缓存
			                                layer.close(index);
			                                console.log(index);
			                                layer.msg("删除成功",{icon:1});
			                            }
			                            else{
			                                layer.msg("删除失败",{icon:5});
			                            }
			                        }
			                    });
			                    layer.close(index); 
			                     });
			      }
			    });

			});

	</script>
</body>
</html>